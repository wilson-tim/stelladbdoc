<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=Cp1252" />
<script src="SP_UPDATE_PNR_REASON_CODES/report.js" type="text/javascript"></script>
<link href="SP_UPDATE_PNR_REASON_CODES/report.css" type="text/css" rel="stylesheet">
</head>
<body>
<div class="banner">
<table width="98%"><tr>
<td><h2 class="banner">SP_UPDATE_PNR_REASON_CODES</h2></td>
</tr></table></div>
<div id="maintabs">
<div class="currentmaintab" onclick="onSelectMainTab(this, 0)">
<div>
<p>Doc</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 1)">
<div>
<p>Details</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 2)">
<div>
<p>Grants</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 3)">
<div>
<p>References</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 4)">
<div>
<p>Dependencies</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 5)">
<div>
<p>Code</p>
</div>
</div>
</div>
<br/>
<div id="masterreports">
<div id="Master.0">
<div class="currentmasterreport">
<TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE><HR><P></P><HR><P></P><A NAME="method_summary"></A><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="3" BORDER="1"><TR CLASS="TableHeadingColor"><TD COLSPAN="2"><FONT SIZE="+2"><B>Method Summary</B></FONT></TD><TR CLASS="TableRowColor"><TD WIDTH="1%" VALIGN="top" ALIGN="right"><FONT SIZE="-1"><CODE>&nbsp;</CODE></FONT></TD><TD><CODE><B><A HREF="#sp_update_pnr_reason_Codes">sp_update_pnr_reason_Codes</A></B>( p_reason_code_from IN CHAR , p_reason_Code_to IN CHAR ) </CODE><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD></TR>
</TABLE>
<P></P><A NAME="method_detail"></A><TABLE WIDTH="100%" CELLSPACING="0" CELLPADDING="3" BORDER="1"><TR CLASS="TableHeadingColor"><TD COLSPAN="2"><FONT SIZE="+2"><B>Method Detail</B></FONT></TD></TABLE><A NAME="sp_update_pnr_reason_Codes"></A>
<H3>sp_update_pnr_reason_Codes</H3><PRE>          <B>sp_update_pnr_reason_Codes</B>( p_reason_code_from IN CHAR , p_reason_Code_to IN CHAR ) </PRE><DL>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<DD><DL></DL></DD></DL><HR><TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE></div>
</div>
<div id="Master.1">
<div class="masterreport">
<table id="Table.0" cellpadding="0" cellspacing="0" summary="">
<th>NAME</th>
<th>VALUE</th>
</tr>
<tr>
<td>OWNER</td>
<td>STELLA</td>
</tr>
<tr>
<td>OBJECT_NAME</td>
<td>SP_UPDATE_PNR_REASON_CODES</td>
</tr>
<tr>
<td>SUBOBJECT_NAME</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_ID</td>
<td>2516787</td>
</tr>
<tr>
<td>DATA_OBJECT_ID</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_TYPE</td>
<td>PROCEDURE</td>
</tr>
<tr>
<td>CREATED</td>
<td>16-JAN-18</td>
</tr>
<tr>
<td>LAST_DDL_TIME</td>
<td>08-JAN-20</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>2020-01-08:11:55:19</td>
</tr>
<tr>
<td>STATUS</td>
<td>VALID</td>
</tr>
<tr>
<td>TEMPORARY</td>
<td>N</td>
</tr>
<tr>
<td>GENERATED</td>
<td>N</td>
</tr>
<tr>
<td>SECONDARY</td>
<td>N</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>1</td>
</tr>
<tr>
<td>EDITION_NAME</td>
<td>null</td>
</tr>
</table>
</div>
</div>
<div id="Master.2">
<div class="masterreport">
<table id="Table.1" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>PRIVILEGE</th>
<th>GRANTEE</th>
<th>GRANTABLE</th>
<th>GRANTOR</th>
<th>OBJECT_NAME</th>
</tr>
<tr onclick="table_onSelectMasterRow(this, 1, 0)" class="currentrow">
<td class="currentcell">EXECUTE</td>
<td class="currentcell">STELLABATCH</td>
<td class="currentcell">NO</td>
<td class="currentcell">STELLA</td>
<td class="currentcell">SP_UPDATE_PNR_REASON_CODES</td>
</tr>
</table>
</div>
</div>
<div id="Master.3">
<div class="masterreport">
<table id="Table.2" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.4">
<div class="masterreport">
<table id="Table.3" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.5">
<div class="masterreport">
<pre>
PROCEDURE sp_update_pnr_reason_Codes (p_reason_code_from IN CHAR,
                                                        p_reason_Code_to IN CHAR) 
                                                        IS
           
/* script to change stella discrepancies enmass from TV reason code to TN
  so that they disappear from users exception screens
  
  this is run regularly because users don't care about TV exceptions


Leigh mar 2004  */

v_count NUMBER(9):=0;
res VARCHAR2(2000);

CURSOR c1 IS 
SELECT * FROM stella.pnr_reconciliation_history p
 WHERE p.reason_code = p_reason_code_from
 AND   p.process_date = (SELECT MAX(process_date) FROM stella.pnr_reconciliation_history p2
WHERE p2.pnr_id = p.pnr_id)
AND p.unmatched_amt &lt; 0
 ;
  
 BEGIN
  dbms_output.put_line ('start:'||to_char(SYSDATE,'yy-mon-dd hh24:mi:ss'));
  dbms_output.put_line ('reas from:'||p_reason_code_from||' reas to'|| p_reason_code_To);
  
 FOR x IN c1 LOOP
 
    res:= stella.p_stella_get_data.update_exception_reason_code('D',x.pnr_id, p_reason_code_to,'REASFIX',x.reason_code);
    dbms_output.put_line('res:'||res);
    v_count := v_count +1;
     
 END LOOP;
 
 dbms_output.put_line('Count of fixed:'||v_count);
 dbms_output.put_line ('end:'||to_char(SYSDATE,'yy-mon-dd hh24:mi:ss')); 
 END;</pre>
</div>
</div>
</div>
</body>
</html>
